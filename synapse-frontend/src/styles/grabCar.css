/* === GrabTaxi Layout + Theme (dark-first) === */
:root{
  --grab-bg:#0b0e13;
  --grab-panel:#0f131a;
  --grab-edge:#283244;
  --grab-muted:#9aa5b3;
  --grab-text:#e6ebf2;
  --grab-accent:#2bd4ff;    /* cyan */
  --grab-accent-2:#8b5cf6;  /* violet */
  --grab-ok:#22c55e;
  --grab-warn:#f59e0b;
  --grab-radius:16px;
  --grab-shadow:0 10px 30px rgb(2 6 23 / 30%);

  /* per-component accents */
  --theme-timeline-start:#2bd4ff;  --theme-timeline-end:#8b5cf6;
  --theme-kpi-start:#22c55e;       --theme-kpi-end:#14b8a6;
  --theme-questions-start:#f59e0b; --theme-questions-end:#fb7185;
  --theme-map-start:#60a5fa;       --theme-map-end:#6366f1;
  --theme-driver-start:#34d399;    --theme-driver-end:#a3e635;
  --theme-summary-start:#f472b6;   --theme-summary-end:#a78bfa;

  /* layout tweaks */
  --gt-timeline-max-h: 320px;
  --topbar-offset: 96px; /* distance from top for overlay */
}

html, body, #root, .grabtaxi-page{
  background: var(--grab-bg);
  color: var(--grab-text);
}

/* ===== Topbar ===== */
.gt-topbar{
  position: sticky; top: 0; z-index: 30;
  display:flex; align-items:center; justify-content:space-between;
  padding: 12px 18px;
  background: linear-gradient(180deg, color-mix(in oklab, var(--grab-bg) 88%, transparent), transparent);
  border-bottom:1px solid color-mix(in oklab, var(--grab-edge) 70%, transparent);
  backdrop-filter: blur(8px);
}
.gt-topbar-title{ font-weight: 700; letter-spacing:.2px; }
.gt-topbar-tools{ display:flex; align-items:center; gap:10px; }
.gt-search{
  display:flex; align-items:center; gap:8px;
  border:1px solid color-mix(in oklab, var(--grab-edge) 70%, transparent);
  background: color-mix(in oklab, var(--grab-panel) 92%, transparent);
  padding: 8px 10px; border-radius: 999px; min-width: 320px;
}
.gt-search input{
  background: transparent; border: none; outline: none; color: var(--grab-text); width: 100%;
}
.gt-icon{
  display:grid; place-items:center; width:36px; height:36px;
  border:1px solid color-mix(in oklab, var(--grab-edge) 70%, transparent);
  border-radius: 999px; background: transparent; color: var(--grab-muted);
}
.gt-avatar{ width:36px; height:36px; border-radius:999px; border:1px solid color-mix(in oklab, var(--grab-edge) 70%, transparent); }

/* ===== Grid (Sidebar | Middle | Right) ===== */
.gt-grid{
  display:grid;
  gap: 22px;
  padding: 14px 18px 28px;
  grid-template-columns: 340px 480px 1fr; /* narrower middle column */
}
.gt-right > * + *, .gt-middle > * + *{ margin-top: 16px; }

/* ===== Cards / common ===== */
.gt-card{
  background: color-mix(in oklab, var(--grab-panel) 94%, transparent);
  border:1px solid color-mix(in oklab, var(--grab-edge) 72%, transparent);
  border-radius: var(--grab-radius);
  box-shadow: 0 6px 18px rgb(2 6 23 / 22%);
}
.gt-dim{ color: var(--grab-muted); }

.btn{
  border-radius: 12px;
  border:1px solid color-mix(in oklab, var(--grab-edge) 70%, transparent);
  transition: transform .12s ease, box-shadow .12s ease, opacity .12s ease;
  padding: 8px 12px; background: transparent; color: var(--grab-text);
}
.btn:hover{ transform: translateY(-1px); box-shadow: 0 8px 22px rgb(2 6 23 / 20%); }
.btn-primary{
  background: linear-gradient(90deg, var(--grab-accent), var(--grab-accent-2));
  border: none; color: #041014;
}

/* ====== LIVE TICKER OVERLAY (centered, longer, half-height) ====== */
.gt-middle{ position: relative; }

/* Center relative to viewport so it sits over the overall middle area */
.gt-ticker-overlay{
  position: fixed;
  top: var(--topbar-offset);
  left: 50%;
  transform: translateX(-50%);
  z-index: 200;
  width: clamp(640px, 68vw, 600px); /* longer horizontally */
  pointer-events: none;
  margin-top: -2%;
}

/* half the previous height: tighter vertical padding, rounder corners */
.gt-ticker-overlay .ticker-content{
  pointer-events: auto;
  display:flex; align-items:center; gap:14px;
  padding: 8px 16px;                         /* tighter (≈ half height) */
  border-radius: 24px;                       /* rounder */
  background:
    linear-gradient(180deg,
      color-mix(in oklab, var(--grab-panel) 97%, transparent),
      color-mix(in oklab, var(--grab-panel) 92%, transparent) 60%),
    linear-gradient(90deg,
      color-mix(in oklab, var(--theme-timeline-start) 16%, transparent),
      color-mix(in oklab, var(--theme-timeline-end) 10%, transparent));
  border:1px solid color-mix(in oklab, var(--theme-timeline-start) 30%, var(--grab-edge));
  box-shadow: 0 12px 28px rgb(2 6 23 / 28%);
  backdrop-filter: blur(6px);
}

.gt-ticker-overlay .live{
  background: color-mix(in oklab, var(--grab-ok) 55%, transparent);
  color: #052b13; font-weight:800; padding:4px 10px; border-radius:999px; font-size:12px;
}
.blink{ animation: blink 1.2s steps(2, start) infinite; }
@keyframes blink { 50% { filter: brightness(0.85) saturate(1.1); } }

.ticker-dots{ display:inline-flex; gap:4px; margin-left: 4px; }
.ticker-dots span{
  width:6px; height:6px; border-radius:999px;
  background: color-mix(in oklab, var(--grab-accent) 80%, white 0%);
  animation: pulse 1.4s ease-in-out infinite;
}
.ticker-dots span:nth-child(2){ animation-delay: .15s; }
.ticker-dots span:nth-child(3){ animation-delay: .3s; }
@keyframes pulse { 0%,100%{ transform:scale(.8); opacity:.7 } 50%{ transform:scale(1.15); opacity:1 } }

.gt-ticker-close{
  margin-left: 6px;
  width: 24px; height: 24px; line-height: 22px;
  border-radius: 999px;
  border:1px solid color-mix(in oklab, var(--grab-edge) 70%, transparent);
  background: transparent; color: var(--grab-muted);
  cursor: pointer;
}
.gt-ticker-close:hover{ color: var(--grab-text); }

/* keep the middle column content from hiding under the fixed overlay on small screens */
@media (max-width: 1200px){
  .gt-middle{ padding-top: 56px; }
}

/* ===== Timeline (themed) ===== */
.gt-timeline-card{
  display:flex; flex-direction:column;
  border-radius: 14px;
  background:
    linear-gradient(180deg, color-mix(in oklab, var(--grab-panel) 94%, transparent), transparent),
    linear-gradient(180deg, color-mix(in oklab, var(--theme-timeline-start) 9%, transparent), transparent);
  border:1px solid color-mix(in oklab, var(--theme-timeline-end) 22%, var(--grab-edge));
}
.gt-timeline-card > .p-3{
  border-bottom: 1px solid color-mix(in oklab, var(--grab-edge) 65%, transparent);
}

.gt-timeline-scroll{
  max-height: var(--gt-timeline-max-h);
  overflow: auto;
  padding: 8px 10px 10px;
  scroll-behavior: smooth;
  mask-image: linear-gradient(to bottom, transparent 0, #000 10px, #000 calc(100% - 10px), transparent 100%);
}
/* scrollbar */
.gt-timeline-scroll::-webkit-scrollbar{ width: 8px; }
.gt-timeline-scroll::-webkit-scrollbar-track{
  background: color-mix(in oklab, var(--grab-panel) 88%, transparent);
  border: 1px solid color-mix(in oklab, var(--grab-edge) 65%, transparent);
  border-radius: 999px;
}
.gt-timeline-scroll::-webkit-scrollbar-thumb{
  background: linear-gradient(180deg,
    color-mix(in oklab, var(--theme-timeline-start) 50%, var(--grab-edge)),
    color-mix(in oklab, var(--theme-timeline-end) 50%, var(--grab-edge))
  );
  border-radius: 999px;
  border: 2px solid color-mix(in oklab, var(--grab-panel) 92%, transparent);
}
.gt-timeline-scroll{ scrollbar-width: thin; scrollbar-color:
  color-mix(in oklab, var(--theme-timeline-start) 55%, var(--grab-edge))
  color-mix(in oklab, var(--grab-panel) 90%, transparent);
}

/* timeline items (compact) */
.gt-empty{ padding: 14px; color: var(--grab-muted); }
.gt-timeline-item{
  border-radius: 12px;
  border: 1px solid color-mix(in oklab, var(--grab-edge) 70%, transparent);
  background: color-mix(in oklab, var(--grab-panel) 92%, transparent);
  padding: 10px 12px; margin: 8px 0;
}
.gt-pill{
  font-size: 10.5px; padding: 2px 8px; border-radius: 999px;
  background: color-mix(in oklab, var(--theme-timeline-start) 20%, transparent);
}
.gt-meta{ color: var(--grab-muted); font-size: 10.5px; }
.gt-collapse{
  border-radius: 12px;
  border:1px solid color-mix(in oklab, var(--grab-edge) 70%, transparent);
  background:#0000001a;
}
.gt-collapse > summary{ cursor:pointer; list-style:none; padding:6px 10px; color: var(--grab-muted); }
.gt-collapse summary::marker, .gt-collapse summary::-webkit-details-marker{ display:none; }

/* ===== KPI Row (themed) ===== */
.kpi-row{
  display:grid; grid-template-columns: repeat(4, minmax(0,1fr));
  gap: 12px;
}
.kpi-pill{
  border-radius: 12px;
  padding: 12px 14px;
  background:
    linear-gradient(180deg, color-mix(in oklab, var(--grab-panel) 92%, transparent), transparent),
    linear-gradient(180deg, color-mix(in oklab, var(--theme-kpi-start) 10%, transparent), transparent);
  border:1px solid color-mix(in oklab, var(--theme-kpi-end) 22%, var(--grab-edge));
}
.kpi-pill .label{ color: var(--grab-muted); font-size: 11px; letter-spacing:.04em; text-transform: uppercase; }
.kpi-pill .value{ font-weight: 700; font-size: 20px; margin-top: 2px; }
.kpi-pill .badge{
  display:inline-flex; align-items:center; justify-content:center;
  min-width:24px; height:24px; padding:0 8px; border-radius:999px;
  background: color-mix(in oklab, var(--grab-warn) 25%, transparent);
  font-weight:700; font-size:12px;
}

/* ===== Agent Questions (themed) ===== */
.gt-choice-card{
  background:
    linear-gradient(180deg, color-mix(in oklab, var(--grab-panel) 94%, transparent), transparent),
    linear-gradient(180deg, color-mix(in oklab, var(--theme-questions-start) 8%, transparent), transparent);
  border:1px solid color-mix(in oklab, var(--theme-questions-end) 22%, var(--grab-edge));
}
.gt-choice-btn{
  width:100%; text-align:left; padding:10px 12px;
  border-radius: 12px;
  border:1px solid color-mix(in oklab, var(--grab-edge) 70%, transparent);
  background: linear-gradient(180deg, color-mix(in oklab, var(--grab-panel) 92%, transparent), transparent);
}
.gt-choice-btn:hover{ border-color: color-mix(in oklab, var(--theme-questions-start) 60%, var(--grab-edge)); }

/* ===== Map (themed) ===== */
.map-frame{
  border-radius: 18px; overflow: hidden;
  border:1px solid color-mix(in oklab, var(--theme-map-end) 22%, var(--grab-edge));
  background:
    linear-gradient(180deg, color-mix(in oklab, var(--grab-panel) 90%, transparent), transparent),
    linear-gradient(180deg, color-mix(in oklab, var(--theme-map-start) 7%, transparent), transparent);
  box-shadow: var(--grab-shadow);
}
.map-frame iframe{
  width:100%; height: 360px; border:0; display:block;
}

/* ===== Driver Card (themed) ===== */
.gt-driver{
  display:flex; align-items:center; justify-content:space-between;
  padding: 12px 14px;
  border-radius: 16px;
  background:
    linear-gradient(180deg, color-mix(in oklab, var(--grab-panel) 92%, transparent), transparent),
    linear-gradient(180deg, color-mix(in oklab, var(--theme-driver-start) 8%, transparent), transparent);
  border:1px solid color-mix(in oklab, var(--theme-driver-end) 22%, var(--grab-edge));
}
.gt-driver .left{ display:flex; gap:12px; align-items:center; }
.gt-driver img{ width:44px; height:44px; border-radius:999px; object-fit:cover; box-shadow: 0 2px 10px rgb(0 0 0 / 25%); }
.gt-driver .chip{
  border:1px solid color-mix(in oklab, var(--grab-edge) 70%, transparent);
  padding:6px 10px; border-radius:999px; font-size:12px; opacity:.9;
}

/* ===== Summary Card (themed) ===== */
.summary-card{
  background:
    linear-gradient(180deg, color-mix(in oklab, var(--grab-panel) 92%, transparent), transparent),
    linear-gradient(180deg, color-mix(in oklab, var(--theme-summary-start) 8%, transparent), transparent);
  border:1px solid color-mix(in oklab, var(--theme-summary-end) 22%, var(--grab-edge));
}
.summary-pre{
  font: 13px/1.55 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  white-space: pre-wrap; word-break: break-word; color: #e5e7eb;
}

/* ===== Responsive ===== */
@media (max-width: 1200px){
  .gt-grid{ grid-template-columns: 300px 460px 1fr; }
  .gt-middle{ padding-top: 56px; } /* keep content clear of fixed overlay */
}
@media (max-width: 1024px){
  .gt-grid{ grid-template-columns: 1fr; }
  .gt-right .kpi-row{ grid-template-columns: repeat(2, minmax(0,1fr)); }
  .map-frame iframe{ height: 320px; }
  :root{ --topbar-offset: 86px; }
  .gt-ticker-overlay{ width: 92vw; }
}

/* ================================================================== */
/* ===================== Modal polish (gs-*) ========================= */
/* ================================================================== */

.gs-modal {
  position: fixed;
  inset: 0;
  z-index: 60;
  display: grid;
  place-items: start center;
  padding: 1rem;
  background: radial-gradient(1200px 800px at 50% 20%, rgba(0,0,0,0.55), rgba(0,0,0,0.78));
  backdrop-filter: blur(4px);
}

.gs-modal-card {
  margin-top: 4rem;
  width: 100%;
  max-width: 880px;
  border-radius: 16px;
  border: 1px solid var(--grab-edge);
  background: linear-gradient(180deg, rgba(23,24,25,0.96), rgba(18,19,20,0.96));
  box-shadow:
    0 18px 40px rgba(0,0,0,0.45),
    0 1px 0 rgba(255,255,255,0.03) inset;
  padding: 20px;
}

.gs-modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 10px;
}

.gs-title {
  font-size: 1.15rem;
  font-weight: 700;
  letter-spacing: 0.2px;
}

.gs-header-actions {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}

.gs-label {
  font-size: 0.75rem;
  color: var(--grab-muted);
}

.gs-select {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  border: 1px solid var(--grab-edge);
  background:
    linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0)) padding-box,
    linear-gradient(180deg, rgba(97,188,109,0.15), rgba(97,188,109,0)) border-box;
  color: #e9f6ec;
  border-radius: 10px;
  padding: 6px 28px 6px 10px;
  font-size: 0.9rem;
  outline: none;
  position: relative;
}
.gs-select:focus {
  border-color: var(--grab-accent);
  box-shadow: 0 0 0 3px rgba(43, 212, 255, 0.18);
}
.gs-select option { color: #111; } /* dropdown list itself */

.btn.sm { padding: 6px 10px; font-size: 0.8rem; }

/* hint row */
.gs-preset-hint {
  margin: 4px 2px 10px;
  font-size: 0.8rem;
  color: var(--grab-muted);
}
.gs-preset-name {
  color: #b6f0c2;
}

/* textarea */
.gs-textarea {
  width: 100%;
  min-height: 180px;
  border-radius: 12px;
  border: 1px solid var(--grab-edge);
  background: rgba(255,255,255,0.02);
  color: #e9f6ec;
  padding: 12px 14px;
  line-height: 1.5;
  font-size: 0.98rem;
  outline: none;
  transition: border-color .15s ease, box-shadow .15s ease;
}
.gs-textarea::placeholder { color: #8aa190; }
.gs-textarea:focus {
  border-color: var(--grab-accent);
  box-shadow: 0 0 0 3px rgba(43, 212, 255, 0.18);
}

/* footer */
.gs-modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
  margin-top: 12px;
}

/* Base input (used in clarify modal free-text) */
.gt-input{
  background: rgba(255,255,255,0.06);
  border: 1px solid color-mix(in oklab, var(--grab-edge) 70%, transparent);
  border-radius: 10px;
  padding: 10px 12px;
  color: var(--grab-text);
}

/* Obvious focus states everywhere */
button:focus-visible, .btn:focus-visible, .gt-input:focus-visible,
.gs-select:focus-visible, .gs-textarea:focus-visible {
  outline: none;
  box-shadow: 0 0 0 3px rgba(43, 212, 255, 0.22) !important;
  border-color: var(--grab-accent) !important;
}

.gt-timeline-grow{
  display:flex;
  flex-direction:column;
  /* topbar + top margins ≈ 120px; tweak to your layout */
  height: calc(100vh - var(--topbar-offset) - 24px);
}
.gt-timeline-grow > .p-3{ /* header row stays fixed height */
  flex: 0 0 auto;
}
.gt-timeline-grow .gt-timeline-scroll{
  flex: 1 1 auto;
  max-height: none;          /* override default cap */
  min-height: 0;             /* allow proper flex scrolling */
}

/* ================================================================== */
/* ================= CMD-Style Timeline Overlay ===================== */
/* ================================================================== */

/* Put overlay below the ticker (200) but above page content. */
.cmd-overlay{
  position: fixed; inset: 0; z-index: 160;
  background: rgba(2,6,23,0.60);
  backdrop-filter: blur(6px);
}
.cmd-window{
  position: absolute; top: 16px; right: 16px; bottom: 16px; left: 16px;
  border-radius: 14px;
  border: 1px solid color-mix(in oklab, var(--grab-edge) 70%, transparent);
  box-shadow: 0 30px 80px rgba(0,0,0,.45);
  display: flex; flex-direction: column;
  background:
    radial-gradient(1200px 800px at 50% 10%, rgba(0,0,0,.78), rgba(0,0,0,.92)),
    repeating-linear-gradient(0deg, rgba(255,255,255,0.02) 0px, rgba(255,255,255,0.02) 1px, transparent 1px, transparent 2px);
}
.cmd-header{
  display:flex; align-items:center; justify-content:space-between;
  padding: 10px 12px;
  border-bottom: 1px solid color-mix(in oklab, var(--grab-edge) 60%, transparent);
  background: linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.2));
}
.cmd-title{
  display:flex; align-items:center; gap:10px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: 13px; letter-spacing:.2px;
  color: #b5f5b5;
}
.blink-dot{ width:10px; height:10px; border-radius:999px; background:#22c55e; box-shadow: 0 0 10px #22c55e; animation: blink 1.2s infinite; }
.cmd-session-id{ color: var(--grab-muted); }
.cmd-close{
  all: unset; cursor: pointer; line-height: 1;
  font-size: 20px; color: var(--grab-muted);
  padding: 6px 10px; border-radius: 8px;
}
.cmd-close:hover{ background: rgba(255,255,255,0.06); color: var(--grab-text); }
.cmd-body{
  flex:1; overflow:auto; padding: 12px;
  color: var(--grab-text);
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
}
.cmd-body .gt-card{ background: transparent; border: 0; box-shadow:none; }
.cmd-body .gt-timeline-scroll{ max-height: unset; }

/* Clarify modal must float above the CMD overlay */
.clarify-modal.gs-modal{ z-index: 180; }
.clarify-modal .gs-modal-card{ max-width: 720px; }


/* ===== AltRoutesMap floating selector ===== */
.altmap-wrap { position: relative; }
.altmap-overlay {
  position: absolute;
  top: 10px;
  right: 10px;
  z-index: 2;
}
.altmap-box {
  display: grid;
  gap: 6px;
  min-width: 220px;
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid color-mix(in oklab, var(--grab-edge) 70%, transparent);
  background:
    linear-gradient(180deg, color-mix(in oklab, var(--grab-panel) 94%, transparent), transparent),
    linear-gradient(90deg, color-mix(in oklab, var(--theme-map-start) 10%, transparent), transparent);
  box-shadow: 0 10px 26px rgb(2 6 23 / 35%);
}
.altmap-box-title { font-weight: 700; }
.altmap-box-meta { font-size: .9rem; color: var(--grab-muted); }
.altmap-box .muted { color: var(--grab-muted); }